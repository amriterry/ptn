function initMenu(){$(".menu ul").hide();$(".menu ul:first").show();$(".menu li").on("click","a",function(){var d=$(this).next();if(d.is("ul")&&d.is(":visible")){console.log("Is visible");return false}if(d.is("ul")&&!d.is(":visible")){console.log("Is not visible");$(".menu ul:visible").slideUp("normal");d.slideDown("normal");return false}})}function noticeAlert(d){$("#notice").fadeIn();$("#notice p").html(d)}function hideNotice(){$("#notice").fadeOut()}
function updSubject(d){$("#subject").empty();$("#subject").append(d)}function updPostTyp(d){$("#postTyp").empty();$("#postTyp").append(d)}function updChapter(d){$("#chapter").empty();$("#chapter").append(d)}function renderImg(d){$("#imgThumbContainer").append('<span class="imgThumb"><img src="'+d.thumbPath+'" alt="'+d.imgName+'" data-width="'+d.imgWidth+'" data-height="'+d.imgHeight+'" data-size="'+d.fileSize+'" data-imgPath="'+d.imgPath+'"/></span>')}
function genImgDetail(d,j,a,b,c,e){$("#imgDetail p").html("Name: "+d+"<br />Dimensions: "+j+" x "+a+"<br />Image Size: "+Math.ceil(b/1024)+' KB<br />Image Path:<input type="text" style="width:100%;padding:0.5em;" name="imgPath" value="'+c+'"><br /><span class="anchor-btn delImg" data-imgLink="'+c+'" data-thumbLink="'+e+'">Delete this Image?</span><br /><i><small>Copy above link and paste to get the image source</small></i>').fadeIn()}
$(document).ready(function(){initMenu();$("#ok").click(function(){hideNotice();return false});$("#11").change(function(){$("#subject").html("<option value=0>-------Subject-------</option><option value=1>Physics</option><option value=2>Chemistry</option><option value=3>Biology</option><option value=4>Maths</option><option value=5>English</option><option value=6>Computer</option>")});$("#12").change(function(){$("#subject").html("<option value=0>-------Subject-------</option><option value=1>Physics</option><option value=2>Chemistry</option><option value=3>Biology</option><option value=4>Maths</option><option value=5>English</option>")});
$(".tbl_container").on("click",".postPend",function(){var a=$(this).attr("data-postId"),b=$(this).attr("data-postTypId");$("tr[data-postId='"+a+"'][data-postTypId='"+b+"'] td:last-child").prepend('<img src="../../assets/img/loading.gif" class="loading">');$.ajax({type:"POST",url:"publish.php",dataType:"json",data:{postId:a,postTypId:b},success:function(c){if(c.success){$("tr[data-postId='"+a+"'][data-postTypId='"+b+"'] td:last-child").html("Posted");$("tr[data-postId='"+a+"'][data-postTypId='"+b+
"'] a.postPend").fadeOut()}else{$(".loading").hide();alert(c.errorMsg)}}})});$(".tbl_container").on("click",".postDel",function(){var a=$(this).attr("data-postId"),b=$(this).attr("data-postTypId");if(confirm("Are you sure you want to delete this post?")==true){$("tr[data-postId='"+a+"'][data-postTypId='"+b+"'] td:last-child").prepend('<img src="../../assets/img/loading.gif" class="loading">');$.ajax({type:"POST",url:"delete.php",dataType:"json",data:{postId:a,postTypId:b},success:function(c){if(c.success)$("tr[data-postId='"+
a+"'][data-postTypId='"+b+"']").slideUp();else{$(".loading").hide();alert(c.errorMsg)}}})}});$(".tbl_container").on("click",".restorePost",function(){var a=$(this).attr("data-postId"),b=$(this).attr("data-postTypId");$("tr[data-postId='"+a+"'][data-postTypId='"+b+"'] td:last-child").prepend('<img src="../../assets/img/loading.gif" class="loading">');$.ajax({type:"POST",url:"restore.php",dataType:"json",data:{postId:a,postTypId:b},success:function(c){console.log(c);if(c.success)$("tr[data-postId='"+
a+"'][data-postTypId='"+b+"']").slideUp();else{$(".loading").hide();alert(c.errorMsg)}}});return false});$(".tbl_container").on("click",".permanentDel",function(){var a=$(this).attr("data-postId"),b=$(this).attr("data-postTypId");if(confirm("Are you sure you want to delete this post forever?")==true){$("tr[data-postId='"+a+"'][data-postTypId='"+b+"'] td:last-child").prepend('<img src="../../assets/img/loading.gif" class="loading">');$.ajax({type:"POST",url:"delForever.php",dataType:"json",data:{postId:a,
postTypId:b},success:function(c){if(c.success)$("tr[data-postId='"+a+"'][data-postTypId='"+b+"']").slideUp();else{$(".loading").hide();alert(c.errorMsg)}}})}return false});$(".subject").hide();$(".postTyp").hide();$(".chapter").hide();$("#file_attach").hide();$("#class").change(function(){var a=$(this).val();if(a!=0){$(".subject").hide();$(".postTyp").hide();$(".chapter").hide();$.ajax({type:"POST",url:"subject_list.php",data:{classId:a},success:function(b){updSubject(b)}});$(".subject").show()}else{$(".subject").hide();
$(".postTyp").hide();$(".chapter").hide()}$("#file_attach").hide()});$("#subject").change(function(){var a=$(this).val();if(a!=0){$(".postTyp").hide();$(".chapter").hide();$.ajax({type:"POST",url:"postTyp_list.php",data:{subjectId:a},success:function(b){updPostTyp(b)}});$(".postTyp").show()}else{$(".postTyp").hide();$(".chapter").hide()}$("#file_attach").hide()});$("#postTyp").change(function(){var a=$(this).val(),b=$("#subject").val();if(a!=0&&a!=3&&a!=4&&a!=5){$(".chapter").hide();$.ajax({type:"POST",
url:"chapter_list.php",data:{selSubId:b},success:function(c){updChapter(c)}});$(".chapter").show();$("#file_attach").hide()}else{$(".chapter").hide();a!=0?$("#file_attach").show():$("#file_attach").hide()}});$("#postTyp").change(function(){var a=$(this).val();a==3||a==4?$("#submitPost").removeAttr("disabled"):$("#submitPost").attr("disabled","disabled")});$("#chapter").change(function(){if($(this).val()==0){$("#file_attach").hide();$("#submitPost").attr("disabled","disabled")}else{$("#file_attach").show();
$("#submitPost").removeAttr("disabled")}});$("#submitPost").click(function(){$(this).attr("disabled","disabled").val("Processing request...");var a=$.trim($("input[name='postTitle']").val()),b=$.trim(tinyMCE.activeEditor.getContent()),c=$("#postTyp").val(),e=c>2?$("#subject").val():$("#chapter").val();if(a==""||b=="")noticeAlert("All fields must be complete!");else{var f=$("input[name='imp']").is(":checked")?1:0;$.ajax({url:"post.php",dataType:"json",type:"post",data:{postTitle:a,postText:b,postTypId:c,
rootSelId:e,imp:f},success:function(g){$("#submitPost").removeAttr("disabled").val("Request to publish");g.success?noticeAlert("Post has been Succesfully submitted!"):noticeAlert(g.errorMsg)}})}return false});$("#updatePost").click(function(){$(this).attr("disabled","disabled").val("Updating...");var a=$.trim($("input[name='postTitle']").val()),b=$.trim(tinyMCE.activeEditor.getContent()),c=$("input[name='postTypId']").val(),e=$("input[name='id']").val();if(a==""||b=="")noticeAlert("All fields must be complete!");
else{var f=$("input[name='imp']").is(":checked")?1:0;$.ajax({url:"update.php",dataType:"json",type:"post",data:{id:e,postTitle:a,postText:b,postTypId:c,imp:f},success:function(g){$("#updatePost").removeAttr("disabled").val("Update");g.success?noticeAlert("Post has been Succesfully updated!"):noticeAlert(g.errorMsg)}})}return false});$("#publishBtn").click(function(){$(this).attr("disabled","disabled").val("Publishing...");var a=$("input[name='id']").val(),b=$("input[name='postTypId']").val();$.ajax({type:"POST",
url:"publish.php",dataType:"json",data:{postId:a,postTypId:b},success:function(c){console.log(c);if(c.success){$("#publishBtn").fadeOut();$(".postStatus").text("Posted");noticeAlert("This post has been successfully published.")}else{alert(c.errorMsg);$("#publishBtn").removeAttr("disabled").val("Publish")}}})});$("#updateAdmin").click(function(){$(this).attr("disabled","disabled").attr("value","Updating...");var a=$.trim($("#updateAdminForm input[name='firstName']").val()),b=$.trim($("#updateAdminForm input[name='lastName']").val()),
c=$.trim($("#updateAdminForm input[name='email']").val()),e=$.trim($("#updateAdminForm input[name='phone']").val()),f=$.trim($("#updateAdminForm input[name='username']").val()),g=$.trim($("#updateAdminForm input[name='password']").val()),k=$.trim($("#updateAdminForm input[name='re-password']").val()),l=$("#updateAdminForm input[name='adminId']").val();$.ajax({type:"POST",url:"update.php",data:{adminId:l,firstName:a,lastName:b,email:c,phone:e,username:f,password:g,repassword:k},success:function(h){if(h==
"empty")noticeAlert("Fill Empty Fields");else if(h=="unmatch"){noticeAlert("Passwords donot match.");$("#updateAdmin input[name='password']").val("");$("#updateAdmin input[name='re-password']").val("")}else if(h=="error")noticeAlert("Opps! Something went wrong. Try again later");else if(h=="alreadyAdded"){noticeAlert("Username is already used. Please user another username");$("#updateAdminForm input[name='username']").focus()}else if(h=="success"){noticeAlert("Admin has been successfully updated");
$("#updateAdminForm input[name='password']").val("");$("#updateAdminForm input[name='re-password']").val("")}$("#updateAdmin").removeAttr("disabled").attr("value","Update")}});return false});$("#addAdmin").click(function(){$(this).attr("disabled","disabled").attr("value","Adding...");var a=$.trim($("#addAdminForm input[name='firstName']").val()),b=$.trim($("#addAdminForm input[name='lastName']").val()),c=$.trim($("#addAdminForm input[name='email']").val()),e=$.trim($("#addAdminForm input[name='phone']").val()),
f=$.trim($("#addAdminForm input[name='username']").val()),g=$.trim($("#addAdminForm input[name='password']").val()),k=$.trim($("#addAdminForm input[name='re-password']").val()),l=$("#addAdminForm select[name='role']").val();$.ajax({type:"POST",url:"addAdmin.php",data:{firstName:a,lastName:b,email:c,phone:e,username:f,password:g,repassword:k,roleId:l},success:function(h){if(h=="empty")noticeAlert("Fill Empty Fields");else if(h=="unmatch"){noticeAlert("Passwords donot match.");$("#addAdminForm input[name='password']").val("");
$("#addAdminForm input[name='re-password']").val("")}else if(h=="error")noticeAlert("Opps! Something went wrong. Try again later");else if(h=="alreadyAdded"){noticeAlert("Username or email is already used. Please user another username");$("#addAdminForm input[name='username']").focus()}else if(h=="success"){noticeAlert("Admin has been successfully Added. Its account details will be sent to its email.");$("#addAdminForm input[name='firstName']").val("");$("#addAdminForm input[name='lastName']").val("");
$("#addAdminForm input[name='email']").val("");$("#addAdminForm input[name='phone']").val("");$("#addAdminForm input[name='username']").val("");$("#addAdminForm input[name='password']").val("");$("#addAdminForm input[name='re-password']").val("")}$("#addAdmin").removeAttr("disabled").attr("value","Add")}});return false});$(".delAdmin").click(function(){$(this).css("opacity","0.5");if(confirm("Are you sure you want to delete this admin?")==true){var a=$(this).attr("data-adminId");$.ajax({type:"post",
url:"del.php",data:{adminId:a},success:function(b){$(this).css("opacity","1");if(b=="error")noticeAlert("Opps! Something went wrong. Try again later");else{noticeAlert("Admin of id "+a+" has been successfully deleted.");$("tr#"+a).slideUp("slow")}}})}else $(this).css("opacity","1");return false});var d=window.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1);if(d!="login.php"&&d!="forgot.php"&&d!="reset.php"){console.log("can initialize");var j=$.jPanelMenu({menu:"#navigation",
trigger:".menu_link",openPosition:"200px",excludedPanelContent:"#header"});if($(window).width()<800){j.on();initMenu();console.log("initialized")}}$(window).resize(function(){if($(window).width()<800){if(!$("html").hasClass("jPanelMenu")&&d!="login.php"&&d!="forgot.php"&&d!="reset.php"){j.on();initMenu()}}else $("html").hasClass("jPanelMenu")&&j.off()});$("#forgotPromptBtn").click(function(){$(".loginResp").attr("id","loginAuth").html("Processing for reseting password...").fadeIn();var a=$.trim($("#forgotForm input.logintxt").val());
a==""?$(".loginResp").attr("id","loginError").html("Enter valid email!"):$.ajax({type:"post",url:"forgot_test.php",dataType:"json",data:{email:a},success:function(b){b.success?$(".loginResp").attr("id","loginSuccess").html("Your Account Details has been sent to your email."):$(".loginResp").attr("id","loginError").html(b.errorMsg)}});return false});$("#passResetBtn").click(function(){$(".loginResp").attr("id","loginAuth").html("Processing for reseting password...").fadeIn();var a=$.trim($("#resetForm input[name='email']").val()),
b=$.trim($("#resetForm input[name='password']").val()),c=$.trim($("#resetForm input[name='repassword']").val()),e=$("#resetForm input[name='token']").val();a==""||b==""||c==""?$(".loginResp").attr("id","loginError").html("Fill All Fields!"):$.ajax({type:"post",url:"reset_test.php",dataType:"json",data:{email:a,password:b,repassword:c,token:e},success:function(f){if(f.success)$(".loginResp").attr("id","loginSuccess").html("Your Account password has been reset.");else{$(".loginResp").attr("id","loginError").html(f.errorMsg);
if(f.error==3){$("#resetForm input[name='password']").val("");$("#resetForm input[name='repassword']").val("")}}}});return false});$("input[name='query']").click(function(){var a=$.trim($("textarea[name='queryString']").val());$(this).attr("disabled","disabled").val("QUERYING...");$.ajax({type:"post",url:"query.php",dataType:"json",data:{query:a},success:function(b){$("input[name='query']").removeAttr("disabled").val("QUERY");if(b.success){noticeAlert("<b> "+a+"</b> :Succesfully Executed.");$("textarea[name='queryString']").val("")}else noticeAlert(b.errorMsg)}});
return false});$("#imgExp").click(function(){$("#imgListDialog").fadeIn();if($("#imgThumbContainer").html()==""){console.log("empty");$.ajax({dataType:"json",url:"getImgList.php",success:function(a){$("#imgThumbContainer").css("background","none");a=="Generating Thumbnails"&&console.log("Generating Thumbnails");for(i=0;i<a.length;i++)renderImg(a[i])},error:function(a,b,c){console.log(a);console.log(b);console.log(c)}})}});$("#imgListDialog .cross").click(function(){$(this).parent().fadeOut();$("#imgThumbContainer .active").removeClass("active");
$("#imgDetail p").fadeOut()});$("#imgThumbContainer").on("mouseenter",".imgThumb",function(){var a=$(this).children("img").attr("alt"),b=$(this).offset().left,c=$(this).offset().top+100;$(this).after('<div class="custom-thumb-alt" style="left:'+b+"px;top:"+c+'px;">'+a+"</div>").fadeIn()});$("#imgThumbContainer").on("mouseleave",".imgThumb",function(){$(".custom-thumb-alt").fadeOut()});$("#imgThumbContainer").on("click",".imgThumb",function(){var a=$(this).children("img").attr("alt"),b=$(this).children("img").attr("data-width"),
c=$(this).children("img").attr("data-height"),e=$(this).children("img").attr("data-size"),f=$(this).children("img").attr("data-imgPath"),g=$(this).children("img").attr("src");genImgDetail(a,b,c,e,f,g);$(".imgThumb").removeClass("active");$(this).addClass("active")});$("#imgDetail p").on("click",".delImg",function(){var a=$(this).attr("data-imgLink"),b=$(this).attr("data-thumbLink");$.ajax({url:"delImg.php",type:"post",dataType:"json",data:{imgLink:a,thumbLink:b},success:function(c){if(c.success){$('.imgThumb img[src="'+
c.thumbLink+'"]').parent().fadeOut();$("#imgDetail p").fadeOut()}else alert("Opps! Something Went Wrong! Please Try Again Later")}})});$("#refreshPostList").click(function(){$(".tbl_container").html('<center><img src="../../assets/img/loading.gif" class="loading"> Loading Posts...</center>');$(".tbl_container").load("renderPostList.php");return false})});
